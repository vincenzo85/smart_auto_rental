#!/usr/bin/env bash
set -euo pipefail

"$(dirname "$0")/_branch-guard.sh"

protected_regex='^(main|master|dev|develop)$'

while read -r local_ref local_sha remote_ref remote_sha; do
  remote_branch="${remote_ref#refs/heads/}"
  if [[ "$remote_branch" =~ $protected_regex ]]; then
    cat <<EOF
[branch-guard] Push bloccata verso '$remote_branch'.
Apri una PR da feature/* invece di push diretto al branch protetto.
EOF
    exit 1
  fi
done
